<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SaÄŸlÄ±klÄ± YaÅŸam â€“ Milyoner TarzÄ± Quiz</title>
  <style>
    :root{
      --bg:#021542;            /* Ana koyu lacivert */
      --ink:#ffffff;           /* Saf beyaz metin */
      --muted:#e2e8ff;         /* Daha aÃ§Ä±k mavi, okunabilir */
      --card:#06235e;          /* KartlarÄ±n koyu laciverti */
      --border:#1a3a8d;        /* Daha belirgin Ã§erÃ§eve */
      --accent:#0f52ba;        /* Mavi-1 */
      --accent2:#3a86ff;       /* Mavi-2 */
      --ok:#22c55e;
      --danger:#ef4444;
      --gold:#ffd700;
      --soft:#0b2d71;          /* Soru kutusu koyu ama okunur */
      --shadow:0 8px 28px rgba(0,0,0,.55);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;color:var(--ink);background:var(--bg);}
    .wrap{max-width:1100px;margin:20px auto;padding:16px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    h1{margin:0;font-size:clamp(22px,4vw,32px);font-weight:900;letter-spacing:.2px}
    .pill{display:inline-flex;gap:10px;align-items:center;border:none;color:#fff;background:linear-gradient(90deg,var(--accent),var(--accent2));padding:10px 14px;border-radius:999px;font-weight:800;box-shadow:var(--shadow);cursor:pointer}

    .layout{display:grid;grid-template-columns:1.4fr .8fr;gap:16px;margin-top:12px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow);color:var(--ink)}

    .stage{padding:16px}
    .qbox{background:var(--soft);border:2px solid var(--accent2);border-radius:16px;padding:16px;box-shadow:var(--shadow)}
    .q{margin:0 0 8px 0;font-size:clamp(18px,2.6vw,24px);font-weight:900;line-height:1.4}
    .meta{display:flex;gap:12px;flex-wrap:wrap;color:var(--muted);font-size:14px}

    .answers{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}
    .ans{position:relative;background:#ffffff;border:2px solid #e5e7eb;border-radius:12px;padding:14px 14px 14px 48px;cursor:pointer;user-select:none;font-size:18px;text-align:left}
    .ans:hover{border-color:#cbd5e1}
    .ans[data-state="chosen"]{outline:3px solid #60a5fa;border-color:#60a5fa}
    .ans[data-state="correct"]{background:#ecfdf5;border-color:#86efac}
    .ans[data-state="wrong"]{background:#fef2f2;border-color:#fecaca}
    .ans .mark{position:absolute;left:14px;top:12px;font-weight:900;color:var(--gold)}

    .controls{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
    .btn{border:2px solid #e5e7eb;border-radius:12px;padding:10px 12px;background:#ffffff;color:var(--ink);box-shadow:var(--shadow);cursor:pointer;font-weight:800}
    .btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;border:none}
    .btn:disabled{opacity:.6;cursor:not-allowed}

    .ladder{padding:16px}
    .ladder h3{margin:6px 0 12px 0}
    .ladder ol{list-style:none;margin:0;padding:0;display:grid;gap:8px}
    .ladder li{display:flex;justify-content:space-between;gap:10px;background:#143a82;border:1px solid var(--border);border-radius:12px;padding:10px 12px;color:#fff}
    .ladder li[data-active="true"]{outline:3px solid var(--gold);background:#1d4599;color:#fff}
    .ladder .step{font-weight:900;color:var(--gold)}
    .ladder .amt{color:var(--muted)}

    .lifelines{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:8px}
    .life{background:#f1f5f9;border:1px solid var(--border);border-radius:10px;padding:10px;font-weight:800;text-align:center;cursor:pointer}
    .life[disabled]{opacity:.5;cursor:not-allowed}

    .explain{margin-top:10px;color:var(--muted);font-size:15px}
    .footer{margin-top:10px;color:var(--muted);font-size:12px;text-align:center}

    .stats{display:flex;gap:8px;flex-wrap:wrap}
    .stat{background:#143a82;border:2px solid var(--border);border-radius:12px;padding:8px 10px;min-width:140px;box-shadow:var(--shadow);color:#ffffff}
    .stat .k{display:block;font-size:12px;color:var(--muted)}
    .stat .v{display:block;font-weight:900;font-size:18px}

    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .namebox{display:flex;gap:8px;align-items:center;background:#143a82;border:2px solid var(--accent2);border-radius:12px;padding:8px 10px;color:var(--ink);box-shadow:var(--shadow)}
    .namebox input{border:none;outline:none;font:inherit}

    #audChart{margin-top:12px}
    .bar{display:flex;gap:8px;align-items:center;margin:4px 0}
    .bar .lbl{width:28px;font-weight:900}
    .bar .track{flex:1;height:14px;background:#e5e7eb;border-radius:999px;overflow:hidden}
    .bar .fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2))}
    .bar .pct{width:40px;text-align:right;font-variant-numeric:tabular-nums}

    .leader{padding:16px}
    .leader h3{margin:6px 0 12px 0}
    table.lb{width:100%;border-collapse:collapse}
    .lb th,.lb td{border-bottom:1px solid var(--border);padding:8px 6px;text-align:left;font-size:14px}
    .lb th{color:var(--muted);font-weight:800}
    .lb td:nth-child(1){width:36px;font-weight:900}
    .lb td:nth-child(2){font-weight:700}
    .empty{color:var(--muted);font-size:14px}

    @media (max-width:880px){
      .layout{grid-template-columns:1fr}
      .answers{grid-template-columns:1fr}
    }
    /* Accessible button & label colors */
    .btn, label.btn { color:#000000 !important; }
    label.btn input { color:#000000 !important; }
    #saveName { color:#000000 !important; }
    #readQ { color:#000000 !important; }
    #rate { filter: invert(1); }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>ğŸ©º SaÄŸlÄ±klÄ± YaÅŸam â€“ Milyoner TarzÄ± Quiz</h1>
      <div class="row">
        <div class="namebox">
          <strong>Ä°sim:</strong>
          <input id="playerName" placeholder="oyuncu adÄ±" maxlength="20" />
          <button id="saveName" class="btn">Kaydet</button>
          <span id="hello" style="color:var(--muted)"></span>
        </div>
        <button id="start" class="pill">Yeni Oyun</button>
        <button id="readQ" class="btn">ğŸ”Š Soruyu Seslendir</button>
        <label class="btn" style="display:flex;gap:6px;align-items:center">
          Ses HÄ±zÄ± <input id="rate" type="range" min="0.7" max="1.4" step="0.05" value="1" /></label>
        <label class="btn" style="display:flex;gap:6px;align-items:center">
          Ses: <select id="voiceSel"></select>
        </label>
        <div class="stats">
          <div class="stat"><span class="k">En YÃ¼ksek KazanÃ§</span><span class="v" id="bestAmt">â‚º0</span></div>
          <div class="stat"><span class="k">En Ã‡ok DoÄŸru</span><span class="v" id="bestCorrect">0</span></div>
          <div class="stat"><span class="k">En Uzun Seri</span><span class="v" id="bestStreak">0</span></div>
        </div>
      </div>
    </header>

    <div class="layout">
      <section class="card stage" aria-live="polite">
        <div class="qbox">
          <div class="meta"><span id="qIndex">Soru 1</span> â€¢ <span id="progress">1 / 15</span> â€¢ <span id="owner"></span></div>
          <p class="q" id="qText">Ã–nce ismini yaz ve kaydet. Sonra â€œYeni Oyunâ€a tÄ±kla.</p>
        </div>
        <div class="answers" id="answers"></div>
        <div class="controls">
          <button id="lock" class="btn primary" disabled>âœ… CevabÄ± Kilitle</button>
          <button id="next" class="btn" disabled>â¡ Sonraki</button>
        </div>
        <div class="lifelines">
          <button id="fifty" class="life">50:50</button>
          <button id="audience" class="life">ğŸ‘¥ Seyirci</button>
          <button id="phone" class="life">ğŸ“ Telefon</button>
        </div>
        <div id="audChart"></div>
        <div class="explain" id="explain"></div>
        <div class="footer">Not: Bu oyun genel saÄŸlÄ±k okuryazarlÄ±ÄŸÄ±nÄ± eÄŸlenceli biÃ§imde desteklemek iÃ§indir; kiÅŸisel tÄ±bbi tavsiye yerine geÃ§mez.</div>
      </section>

      <aside class="card ladder">
        <h3>Para Merdiveni</h3>
        <ol id="ladder"></ol>
      </aside>

      <section class="card leader">
        <h3>Liderlik Tablosu (Yerel)</h3>
        <table class="lb" id="lbTable"></table>
      </section>

    </div>
  </div>

  <script>
  (()=>{
    const $ = (s)=>document.querySelector(s);
    const $$ = (s)=>Array.from(document.querySelectorAll(s));

    // === Skor ve oyuncu kayÄ±tlarÄ± ===
    const store = {
      keyStats:'hlth_quiz_leaderboard_v1',
      read(){ try{ return JSON.parse(localStorage.getItem(this.keyStats)||'{}'); }catch(e){ return {}; } },
      write(v){ localStorage.setItem(this.keyStats, JSON.stringify(v)); }
    };
    const board = store.read(); // {playerName: {bestAmount,bestCorrect,bestStreak,plays}}

    let currentPlayer = localStorage.getItem('hlth_quiz_player')||'';
    $('#playerName').value = currentPlayer;
    if (currentPlayer) {
      $('#hello').textContent = `Merhaba, ${currentPlayer}!`;
      $('#owner').textContent = `Oyuncu: ${currentPlayer}`;
    }
    $('#saveName').addEventListener('click',()=>{
      const name = ($('#playerName').value||'').trim().slice(0,20);
      if(!name){ alert('LÃ¼tfen bir isim yaz.'); return; }
      currentPlayer = name; localStorage.setItem('hlth_quiz_player', name);
      if(!board[name]) board[name] = {bestAmount:0,bestCorrect:0,bestStreak:0,plays:0};
      store.write(board);
      $('#hello').textContent = `Merhaba, ${name}!`;
      $('#owner').textContent = `Oyuncu: ${name}`;
      refreshStatsUI(); renderLeaderboard();
    });

    function getStats(){
      if(!currentPlayer || !board[currentPlayer]) return {bestAmount:0,bestCorrect:0,bestStreak:0,plays:0};
      return board[currentPlayer];
    }
    function setStats(s){ if(!currentPlayer) return; board[currentPlayer]=s; store.write(board); }

    function fmtAmt(n){ return 'â‚º'+(n||0).toLocaleString('tr-TR'); }
    function refreshStatsUI(){
      const s = getStats();
      $('#bestAmt').textContent = fmtAmt(s.bestAmount);
      $('#bestCorrect').textContent = s.bestCorrect;
      $('#bestStreak').textContent = s.bestStreak;
    }
    refreshStatsUI();

    // === Para merdiveni ===
    const ladder = [100,200,300,500,1000, 2000,4000,8000,16000,32000, 64000,125000,250000,500000,1000000];

    // === Soru bankasÄ± â€” METNE UYUMLU ===
    const bank = [
      // 1) Beslenme â€“ â€œGÃ¶kkuÅŸaÄŸÄ± GÃ¼cÃ¼â€, su, yapÄ±cÄ±â€‘onarÄ±cÄ±lar, tam tahÄ±llar
      {id:101, topic:"beslenme", src:"1.Roket YakÄ±tÄ±", q:"Dengeli bir tabak neden rengÃ¢renk olmalÄ±dÄ±r?", a:["SÃ¼s olsun diye","FarklÄ± vitamin ve mineraller iÃ§in","Daha pahalÄ± gÃ¶rÃ¼nmesi iÃ§in","FotoÄŸrafta gÃ¼zel dursun diye"], c:1, info:"Metinde sebzeâ€‘meyvelerin renkleri farklÄ± vitamin/mineral getirir."},
      {id:102, topic:"beslenme", src:"1.Roket YakÄ±tÄ±", q:"Metne gÃ¶re vÃ¼cudun en doÄŸal iÃ§eceÄŸi nedir?", a:["Gazoz","Su","Enerji iÃ§eceÄŸi","AromalÄ± ÅŸurup"], c:1, info:"Su, beynin hÄ±zlÄ± mesaj gÃ¶ndermesine yardÄ±m eder."},
      {id:103, topic:"beslenme", src:"1.Roket YakÄ±tÄ±", q:"YapÄ±cÄ±â€‘OnarÄ±cÄ± ekip hangi besinlerden oluÅŸur?", a:["Åeker ve Ã§ikolata","SÃ¼t, yumurta ve et","Sadece makarna","Sadece meyve"], c:1, info:"KaslarÄ± gÃ¼Ã§lÃ¼ tutar."},
      {id:104, topic:"beslenme", src:"1.Roket YakÄ±tÄ±", q:"Tam tahÄ±llar (Ã¶r. tam buÄŸday ekmeÄŸi) bize ne saÄŸlar?", a:["Sadece tat","Enerji","HiÃ§bir ÅŸey","Daha Ã§ok tuz"], c:1, info:"GÃ¼n boyu yetecek enerji deposudur."},
      {id:105, topic:"beslenme", src:"1.Roket YakÄ±tÄ±", q:"â€˜GÃ¶kkuÅŸaÄŸÄ± GÃ¼cÃ¼â€™ ifadesi metinde neyi anlatÄ±r?", a:["RengÃ¢renk sebzeâ€‘meyveleri","GazlÄ± iÃ§ecekleri","Abur cuburu","BaharatlarÄ±"], c:0, info:"KÄ±rmÄ±zÄ± domates, yeÅŸil Ä±spanak, mor Ã¼zÃ¼m vb."},
      {id:106, topic:"beslenme", src:"1.Roket YakÄ±tÄ±", q:"AÅŸaÄŸÄ±dakilerden hangisi dengeli ara Ã¶ÄŸÃ¼ndÃ¼r?", a:["Cips","Meyve yoÄŸurt","Åerbetli tatlÄ±","Gazoz"], c:1, info:"Meyve + yoÄŸurt hafif ve faydalÄ±dÄ±r."},
      {id:107, topic:"beslenme", src:"1.Roket YakÄ±tÄ±", q:"Beynin hÄ±zlÄ± mesaj gÃ¶ndermesine hangi iÃ§ecek yardÄ±m eder?", a:["Su","Kola","Enerji iÃ§eceÄŸi","Gazoz"], c:0, info:"Metinde Ã¶zellikle su vurgulanÄ±r."},
      {id:108, topic:"beslenme", src:"1.Roket YakÄ±tÄ±", q:"KaslarÄ±n gÃ¼Ã§lÃ¼ kalmasÄ± iÃ§in hangisi daha uygundur?", a:["KremalÄ± pasta","SÃ¼tâ€‘yumurtaâ€‘et","Åekerleme","GazlÄ± iÃ§ecek"], c:1, info:"YapÄ±cÄ±â€‘onarÄ±cÄ± gruptur."},
      {id:109, topic:"beslenme", src:"1.Roket YakÄ±tÄ±", q:"AÅŸaÄŸÄ±dakilerden hangisi enerji deposu deÄŸildir?", a:["Tam tahÄ±llar","Tam buÄŸday ekmeÄŸi","GazlÄ± iÃ§ecek","Yulaf"], c:2, info:"GazlÄ± iÃ§ecek enerji vermez, ÅŸeker yÃ¼kÃ¼ yapar."},
      {id:110, topic:"beslenme", src:"1.Roket YakÄ±tÄ±", q:"Renkli bir tabak neyin gÃ¶stergesidir?", a:["Sadece sÃ¼s","Besin Ã§eÅŸitliliÄŸi","PahalÄ±lÄ±k","TatlÄ± aÄŸÄ±rlÄ±ÄŸÄ±"], c:1, info:"Ã‡eÅŸit Ã§oksa vitaminâ€‘mineral Ã§eÅŸitliliÄŸi artar."},

      // 2) Hareket â€“ gÃ¼nde â‰¥60 dk, oksijen, dikkat, â€œseviye atlamaâ€
      {id:201, topic:"hareket", src:"2.Hareket", q:"VÃ¼cudumuz ne iÃ§in tasarlanmÄ±ÅŸtÄ±r?", a:["SÃ¼rekli oturmak","Hareket etmek","Uyumak","Sadece oyun oynamak"], c:1, info:"Hareket hem kaslarÄ± hem beyni Ã§alÄ±ÅŸtÄ±rÄ±r."},
      {id:202, topic:"hareket", src:"2.Hareket", q:"Hareket beynimize nasÄ±l yardÄ±m eder?", a:["Oksijeni artÄ±rÄ±r","Bilgileri siler","Uykuyu bozar","HiÃ§bir etkisi yok"], c:0, info:"Kan dolaÅŸÄ±mÄ± hÄ±zlanÄ±r, beyin daha Ã§ok oksijen alÄ±r."},
      {id:203, topic:"hareket", src:"2.Hareket", q:"GÃ¼nde en az kaÃ§ dakika hareket Ã¶nerilir?", a:["10","30","60","5"], c:2, info:"Metin: en az bir saat."},
      {id:204, topic:"hareket", src:"2.Hareket", q:"Hareket etmek ders Ã§alÄ±ÅŸÄ±rken neyi kolaylaÅŸtÄ±rÄ±r?", a:["Dikkat ve kavrama","Uykusuzluk","SÃ¼rekli aÃ§lÄ±k","Unutma"], c:0, info:"OkuduÄŸunu daha iyi kavrama saÄŸlar."},
      {id:205, topic:"hareket", src:"2.Hareket", q:"Metinde hareket neye benzetilir?", a:["Oyunu kapatmaya","Seviye atlamaya","Can kaybetmeye","Hata vermeye"], c:1, info:"Daha hÄ±zlÄ± ve Ã§evik olmayÄ± saÄŸlar."},
      {id:206, topic:"hareket", src:"2.Hareket", q:"Hangisi kÃ¼Ã§Ã¼k bir gÃ¼nlÃ¼k hareket Ã¶rneÄŸidir?", a:["AsansÃ¶r","Merdiven","Saatlerce oturma","HiÃ§ kÄ±pÄ±rdamama"], c:1, info:"KÄ±sa hareket molalarÄ± faydalÄ±dÄ±r."},
      {id:207, topic:"hareket", src:"2.Hareket", q:"Hareketsizlik hangi hisse yol aÃ§abilir?", a:["Daha zinde","Daha yavaÅŸ/yorgun","SÃ¼per hÄ±zlÄ±","HiÃ§ deÄŸiÅŸmez"], c:1, info:"Hareket eksikliÄŸi enerjiyi dÃ¼ÅŸÃ¼rÃ¼r."},
      {id:208, topic:"hareket", src:"2.Hareket", q:"AÅŸaÄŸÄ±dakilerden hangisi gÃ¼nlÃ¼k hareket sayÄ±lmaz?", a:["KoÅŸma/zÄ±plama","YÃ¼zme","SÃ¼rekli ekran","YÃ¼rÃ¼yÃ¼ÅŸ"], c:2, info:"SÃ¼rekli ekran baÅŸÄ± hareketsizliktir."},
      {id:209, topic:"hareket", src:"2.Hareket", q:"Hareket etmek beynin hangi ihtiyacÄ±nÄ± artÄ±rÄ±r?", a:["Åeker","Oksijen","Tuz","YaÄŸ"], c:1, info:"Oksijen artÄ±ÅŸÄ± dikkat/Ã¶ÄŸrenmeyi destekler."},
      {id:210, topic:"hareket", src:"2.Hareket", q:"Hareketli olmak bizi nasÄ±l etkiler?", a:["Daha Ã§evik yapar","Daha yavaÅŸlatÄ±r","Daima uykusuz bÄ±rakÄ±r","Dersleri zorlaÅŸtÄ±rÄ±r"], c:0, info:"Metin: hÄ±zlÄ± ve Ã§evik yapar."},

      // 3) Uyku â€“ gizli laboratuvar, 9â€“11 saat, onarÄ±m, bÃ¼yÃ¼me hormonu
      {id:301, topic:"uyku", src:"3.Uyku", q:"Uyku metinde neye benzetilmiÅŸtir?", a:["Gizli laboratuvara","Sessiz sÄ±nÄ±fa","KapalÄ± kutuya","Oyun alanÄ±na"], c:0, info:"Uyurken vÃ¼cut Ã§alÄ±ÅŸmaya devam eder."},
      {id:302, topic:"uyku", src:"3.Uyku", q:"10 yaÅŸ iÃ§in Ã¶nerilen uyku sÃ¼resi nedir?", a:["3â€“4 saat","6â€“7 saat","9â€“11 saat","12â€“15 saat"], c:2, info:"Metinde 9â€“11 saat."},
      {id:303, topic:"uyku", src:"3.Uyku", q:"Uyku sÄ±rasÄ±nda neler olur?", a:["HÃ¼cre onarÄ±mÄ± ve bilgi dÃ¼zenleme","Sadece oyun","Bilgileri silme","SÃ¼rekli bÃ¼yÃ¼me durur"], c:0, info:"OnarÄ±m ve Ã¶ÄŸrenilenlerin dÃ¼zeni."},
      {id:304, topic:"uyku", src:"3.Uyku", q:"Uyku sÄ±rasÄ±nda salgÄ±lanan Ã¶nemli hormon hangisi?", a:["Kafein hormonu","BÃ¼yÃ¼me hormonu","Tuz hormonu","YaÄŸ hormonu"], c:1, info:"Metin: bÃ¼yÃ¼me hormonlarÄ± salgÄ±lanÄ±r."},
      {id:305, topic:"uyku", src:"3.Uyku", q:"Yetersiz uyku sabah bizi nasÄ±l hissettirir?", a:["Ã‡ok dinÃ§","Yorgun","SÃ¼per hÄ±zlÄ±","HiÃ§ deÄŸiÅŸmez"], c:1, info:"Uykusuzluk yorgunluk yapar."},
      {id:306, topic:"uyku", src:"3.Uyku", q:"Uyku Ã¶ÄŸrenmeyi nasÄ±l etkiler?", a:["Bilgileri dÃ¼zenler","Hepsini unutturur","HiÃ§ etkisi yok","Sadece oyun puanÄ± verir"], c:0, info:"GÃ¼n iÃ§i bilgiler dÃ¼zenlenir."},
      {id:307, topic:"uyku", src:"3.Uyku", q:"â€˜Gizli laboratuvarâ€™ benzetmesi neyi vurgular?", a:["VÃ¼cudun gece Ã§alÄ±ÅŸmasÄ±nÄ±","Sadece sessizliÄŸi","SÄ±nÄ±f kurallarÄ±nÄ±","Oyun oynamayÄ±"], c:0, info:"Gece onarÄ±m ve dÃ¼zenleme sÃ¼rer."},
      {id:308, topic:"uyku", src:"3.Uyku", q:"Ä°yi uyku ertesi gÃ¼ne nasÄ±l etki eder?", a:["SÃ¼rekli uykusuz","SÃ¼per enerjiyle baÅŸlatÄ±r","Daha hasta yapar","HiÃ§ etkisi yok"], c:1, info:"Metinde anahtar olarak anlatÄ±lÄ±r."},
      {id:309, topic:"uyku", src:"3.Uyku", q:"Uyku eksikliÄŸi derste neye yol aÃ§abilir?", a:["Daha Ã§ok dikkat","Dikkatin azalmasÄ±","AnÄ±nda seviye atlama","Derslerin kolaylaÅŸmasÄ±"], c:1, info:"Dikkat dÃ¼ÅŸer, kavrama zorlaÅŸÄ±r."},
      {id:310, topic:"uyku", src:"3.Uyku", q:"Uyku hÃ¼creleri nasÄ±l etkiler?", a:["OnarÄ±r","Yorar","Dondurur","YavaÅŸlatÄ±r"], c:0, info:"HÃ¼cre onarÄ±mÄ± uyku sÄ±rasÄ±nda hÄ±zlanÄ±r."},

      // 4) Hijyen â€“ gÃ¶rÃ¼nmez kalkan, el yÄ±kama zamanlarÄ±
      {id:401, topic:"hijyen", src:"4.Hijyen", q:"Hijyen metinde neye benzetilir?", a:["GÃ¶rÃ¼nmez kalkan","Roket","Araba","Robot"], c:0, info:"Mikroplara karÅŸÄ± kalkan."},
      {id:402, topic:"hijyen", src:"4.Hijyen", q:"Ellerimizi Ã¶zellikle ne zaman yÄ±kamalÄ±yÄ±z?", a:["Sadece sabah","Yemekten Ã¶nce ve tuvaletten sonra","HiÃ§ gerek yok","Sadece okulda"], c:1, info:"Metinde bu zamanlar vurgulanÄ±r."},
      {id:403, topic:"hijyen", src:"4.Hijyen", q:"DÄ±ÅŸarÄ±dan eve gelince ne yapmalÄ±yÄ±z?", a:["Ellerimizi sabunla yÄ±kamak","Hemen oyun","HiÃ§bir ÅŸey","Sadece suya tutmak"], c:0, info:"Mikrop bulaÅŸmasÄ±nÄ± azaltÄ±r."},
      {id:404, topic:"hijyen", src:"4.Hijyen", q:"El yÄ±kamanÄ±n amacÄ± nedir?", a:["MikroplarÄ± uzaklaÅŸtÄ±rmak","Ellerimizi kirletmek","SÃ¼s olsun diye","Koku vermek"], c:0, info:"Basit ama gÃ¼Ã§lÃ¼ bir alÄ±ÅŸkanlÄ±k."},
      {id:405, topic:"hijyen", src:"4.Hijyen", q:"Mikroplar metinde nasÄ±l tanÄ±mlanÄ±r?", a:["GÃ¶rÃ¼nmez dÃ¼ÅŸmanlar","Renkli toplar","Sevimli oyuncaklar","IÅŸÄ±klar"], c:0, info:"GÃ¶rÃ¼nmez tehlike benzetmesi."},
      {id:406, topic:"hijyen", src:"4.Hijyen", q:"Sadece suyla el yÄ±kamak yeterli midir?", a:["Evet","HayÄ±r, sabun gerekir","Bazen","HiÃ§ Ã¶nemli deÄŸil"], c:1, info:"Sabunla iyice yÄ±kamalÄ±yÄ±z."},
      {id:407, topic:"hijyen", src:"4.Hijyen", q:"El yÄ±kamak hangi durumlarda en kritiktir?", a:["Spor sonrasÄ±","Yemekten Ã¶nce, tuvaletten sonra, eve gelince","Oyun bitince","Ders sÄ±rasÄ±nda"], c:1, info:"Metindeki Ã¼Ã§ zaman bir arada."},
      {id:408, topic:"hijyen", src:"4.Hijyen", q:"Hijyen saÄŸlÄ±ÄŸÄ±mÄ±zÄ± nasÄ±l korur?", a:["MikroplarÄ± davet eder","BulaÅŸmayÄ± azaltÄ±r","Bizi daha hasta eder","HiÃ§bir etkisi yok"], c:1, info:"Koruyucu kalkan gÃ¶revi gÃ¶rÃ¼r."},
      {id:409, topic:"hijyen", src:"4.Hijyen", q:"AÅŸaÄŸÄ±dakilerden hangisi hijyen davranÄ±ÅŸÄ±dÄ±r?", a:["Kirli ellerle yemek","Ellerini sabunla yÄ±kamak","Yere Ã¶ksÃ¼rmek","Her yere dokunmak"], c:1, info:"Basit ve etkili alÄ±ÅŸkanlÄ±klar."},
      {id:410, topic:"hijyen", src:"4.Hijyen", q:"Hijyenin â€˜gÃ¶rÃ¼nmez kalkanâ€™ denmesi neyi anlatÄ±r?", a:["MikroplarÄ±n gÃ¶rÃ¼nÃ¼r olmasÄ±nÄ±","Mikroplara karÅŸÄ± korumayÄ±","Oyunu kazanmayÄ±","HÄ±zlÄ± koÅŸmayÄ±"], c:1, info:"Temizlik, mikroplara karÅŸÄ± koruyucu bir kalkan gibidir."}
    ];

    // === Durum ===
    const QUESTIONS_PER_GAME = 15; // <- Ã–NEMLÄ°: createDeck'ten Ã–NCE!
    let deck = [];
    const state = { i:-1, locked:false, chosen:null, used:{fifty:false,audience:false,phone:false}, correct:0, streak:0 };

    // === UI referanslarÄ± ===
    const ansBox = $('#answers');
    const qText = $('#qText');
    const qIndex = $('#qIndex');
    const progress = $('#progress');
    const explain = $('#explain');
    const lockBtn = $('#lock');
    const nextBtn = $('#next');
    const rate = $('#rate');
    const ladderEl = $('#ladder');
    const audChart = $('#audChart');

    // === Ses efektleri (Web Audio) ===
    let AC; const ctx = ()=> AC||(AC=new (window.AudioContext||window.webkitAudioContext)());
    function tone(freq, dur=0.2, type='sine', vol=0.15){
      const a = ctx(); const o=a.createOscillator(); const g=a.createGain();
      o.type=type; o.frequency.value=freq; g.gain.value=vol; o.connect(g); g.connect(a.destination);
      const t=a.currentTime; g.gain.setValueAtTime(vol,t); g.gain.exponentialRampToValueAtTime(0.0001, t+dur);
      o.start(t); o.stop(t+dur);
    }
    function sfxCorrect(){ tone(523,0.12,'triangle'); setTimeout(()=>tone(659,0.12,'triangle'),120); setTimeout(()=>tone(784,0.18,'triangle',0.18),240); }
    function sfxWrong(){ tone(110,0.25,'sawtooth',0.2); setTimeout(()=>tone(90,0.3,'sawtooth',0.18),220); }

    // === Para merdiveni Ã§izimi ===
    function drawLadder(active){
      ladderEl.innerHTML = ladder.map((amt,idx)=>{
        const step = idx+1; const isActive = active===idx; const g = (step===5||step===10)? ' â€” Garantili' : '';
        return `<li data-active="${isActive}"><span class="step">${step}. Soru</span><span class="amt">${fmtAmt(amt)}${g}</span></li>`;
      }).reverse().join('');
    }
    drawLadder(-1);
    function guaranteedAmount(idx){ if(idx>=9) return ladder[9]; if(idx>=4) return ladder[4]; return 0; }

    // === Oyun kontrol ===
    function start(){
      if(!currentPlayer){ alert('Ã–nce ismini yaz ve Kaydetâ€™e bas.'); return; }
      state.i = -1; state.locked=false; state.chosen=null; state.used={fifty:false,audience:false,phone:false}; state.correct=0; state.streak=0;
      deck = createDeck();
      $$('.life').forEach(b=>{ b.disabled=false; });
      next();
    }

    function next(){
      state.i++;
      if(state.i>=deck.length){ finish(true); return; }
      const item = deck[state.i];
      qText.textContent = item.q;
      qIndex.textContent = `Soru ${state.i+1}`;
      progress.textContent = `${state.i+1} / ${deck.length}`;
      explain.textContent = '';
      audChart.innerHTML = '';
      lockBtn.disabled = true; nextBtn.disabled = true;
      state.locked=false; state.chosen=null;
      drawAnswers(item);
      highlightLadder();
      readQuestion();
    }

    function drawAnswers(item){
      const letters = ['A','B','C','D'];
      ansBox.innerHTML = item.a.map((t,idx)=>`<button class="ans" data-idx="${idx}" data-state="idle"><span class="mark">${letters[idx]}</span>${t}</button>`).join('');
      $$('.ans').forEach(btn=> btn.addEventListener('click',()=>choose(+btn.dataset.idx)) );
    }

    function choose(idx){
      if(state.locked) return; state.chosen=idx; lockBtn.disabled=false; nextBtn.disabled=true;
      $$('.ans').forEach(b=>b.dataset.state='idle');
      const chosenBtn = $$('.ans')[idx];
      chosenBtn.dataset.state='chosen';
    }

    function lock(){
      if(state.chosen==null || state.locked) return; state.locked=true;
      const item = deck[state.i];
      const correct = state.chosen===item.c;
      $$('.ans').forEach((b,i)=>{
        if(i===item.c) b.dataset.state='correct';
        else if(i===state.chosen) b.dataset.state='wrong';
        else b.dataset.state='idle';
      });
      if(correct){ state.correct++; state.streak++; sfxCorrect(); }
      else { state.streak=0; sfxWrong(); }
      explain.textContent = (correct? 'DoÄŸru! ':'YanlÄ±ÅŸ. ') + (item.info||'');
      nextBtn.disabled=false; lockBtn.disabled=true;
      if(!correct){ finish(false); }
    }

    function finish(won){
      const idx = Math.min(state.i, deck.length-1);
      const prize = won? ladder[ladder.length-1] : guaranteedAmount(idx-1);
      qText.textContent = won? `Tebrikler! ${fmtAmt(prize)} kazandÄ±n, ${currentPlayer}!` : `Oyun bitti, ${currentPlayer}. KazanÄ±lan garanti tutar: ${fmtAmt(prize)}.`;
      ansBox.innerHTML = '';
      explain.textContent = `DoÄŸru sayÄ±n: ${state.correct}. Yeniden oynamak iÃ§in â€œYeni Oyunâ€.`;
      nextBtn.disabled=true; lockBtn.disabled=true;
      $$('.life').forEach(b=> b.disabled=true);
      drawLadder(-1);

      const s = getStats();
      if(prize>s.bestAmount) s.bestAmount=prize;
      if(state.correct>s.bestCorrect) s.bestCorrect=state.correct;
      if(state.streak>s.bestStreak) s.bestStreak=state.streak;
      s.plays=(s.plays||0)+1; setStats(s); refreshStatsUI(); renderLeaderboard();
    }

    function highlightLadder(){
      const items = Array.from(ladderEl.querySelectorAll('li')).reverse();
      items.forEach((li,i)=> li.dataset.active = (i===state.i));
    }

    // === Jokerler ===
    $('#fifty').addEventListener('click',()=>{
      if(state.used.fifty||state.i<0) return; state.used.fifty=true; $('#fifty').disabled=true;
      const item = deck[state.i];
      const pool = [0,1,2,3].filter(i=> i!==item.c);
      shuffle(pool); const toHide = pool.slice(0,2);
      toHide.forEach(i=>{ const b = $$('.ans')[i]; b.disabled=true; b.style.opacity=.55; });
    });

    $('#audience').addEventListener('click',()=>{
      if(state.used.audience||state.i<0) return; state.used.audience=true; $('#audience').disabled=true;
      const item = deck[state.i];
      const base = [10,10,10,10]; base[item.c]+=50+Math.floor(Math.random()*21);
      const sum = base.reduce((a,b)=>a+b,0); const pct = base.map(v=> Math.round(100*v/sum));
      drawAudienceChart(pct);
      speak(`Seyirci oylamasÄ±: A yÃ¼zde ${pct[0]}, B yÃ¼zde ${pct[1]}, C yÃ¼zde ${pct[2]}, D yÃ¼zde ${pct[3]}.`);
    });

    $('#phone').addEventListener('click',()=>{
      if(state.used.phone||state.i<0) return; state.used.phone=true; $('#phone').disabled=true;
      const item = deck[state.i];
      const suggestion = Math.random()<0.75 ? item.c : randInt(0,3);
      const letters = ['A','B','C','D'];
      speak(`Bence cevap ${letters[suggestion]} olabilir, ama emin deÄŸilim.`);
    });

    function drawAudienceChart(pct){
      const letters=['A','B','C','D'];
      audChart.innerHTML = letters.map((l,i)=>
        `<div class="bar"><span class="lbl">${l}</span><div class="track"><div class="fill" style="width:${pct[i]}%"></div></div><span class="pct">%${pct[i]}</span></div>`
      ).join('');
    }

    // === TTS ===
    document.getElementById('readQ').addEventListener('click', ()=>readQuestion());
    function readQuestion(){
      if(state.i<0) return;
      const item = deck[state.i];
      const letters = ['A','B','C','D'];
      const text = `Soru ${state.i+1}. ${item.q}. SeÃ§enekler: ` + item.a.map((t,i)=>`${letters[i]}: ${t}`).join(', ');
      speak(text);
    }
    function speak(text){
      try{ window.speechSynthesis.cancel(); }catch(e){}
      const u = new SpeechSynthesisUtterance(text);
      const vs = speechSynthesis.getVoices();
      const tr = vs.find(v=>/tr|Turk/i.test(v.lang||v.name)) || vs.find(v=>/Turk/i.test(v.name||''));
      if(tr){ u.voice = tr; u.lang = tr.lang || 'tr-TR'; }
      else { u.lang = 'tr-TR'; }
      u.rate = parseFloat(rate.value||'1');
      speechSynthesis.speak(u);
    }
    // === AraÃ§lar ===
    function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }
    function randInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
    function escapeHtml(s){ const map = {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}; return String(s).replace(/[&<>"']/g, ch => map[ch]); }

    function createDeck(){
      const idxs = [...Array(bank.length).keys()];
      shuffle(idxs);
      const pick = idxs.slice(0, QUESTIONS_PER_GAME);
      return pick.map(i=>{
        const it = bank[i];
        const perm = shuffle([0,1,2,3]);
        const a = perm.map(k=> it.a[k]);
        const c = perm.indexOf(it.c);
        return {id: it.id, q: it.q, a, c, info: it.info};
      });
    }

    function renderLeaderboard(){
      const all = store.read();
      const rows = Object.entries(all).map(([name,s])=>({name, ...(s||{})}));
      rows.sort((a,b)=> (b.bestAmount||0)-(a.bestAmount||0) || (b.bestCorrect||0)-(a.bestCorrect||0) || (b.bestStreak||0)-(a.bestStreak||0) || (b.plays||0)-(a.plays||0));
      const top = rows.slice(0,10);
      const el = document.getElementById('lbTable');
      if(!el) return;
      if(top.length===0){ el.innerHTML = '<tr><td class="empty">HenÃ¼z kayÄ±t yok.</td></tr>'; return; }
      el.innerHTML = '<thead><tr><th>#</th><th>Oyuncu</th><th>En YÃ¼ksek</th><th>DoÄŸru</th><th>Seri</th><th>Oyun</th></tr></thead>'+
        '<tbody>'+
        top.map((r,i)=>`<tr><td>${i+1}</td><td>${escapeHtml(r.name)}</td><td>${fmtAmt(r.bestAmount||0)}</td><td>${r.bestCorrect||0}</td><td>${r.bestStreak||0}</td><td>${r.plays||0}</td></tr>`).join('')+
        '</tbody>';
    }

    // === Olaylar ===
    $('#start').addEventListener('click', start);
    $('#lock').addEventListener('click', lock);
    $('#next').addEventListener('click', next);

    // Klavye kÄ±sayollarÄ±
    window.addEventListener('keydown', (e)=>{
      if(['1','2','3','4'].includes(e.key)){
        const idx = +e.key - 1; const b = $$('.ans')[idx]; if(b && !b.disabled) choose(idx);
      }
      if(e.key==='Enter'){ if(!lockBtn.disabled) lock(); else if(!nextBtn.disabled) next(); }
      if(e.key===' '){ e.preventDefault(); readQuestion(); }
    });

    // === Kendini Testler (console) â€” testleri deÄŸiÅŸtirmeyin ===
    function runSelfTests(){
      const tests = [];
      const d = createDeck();
      tests.push({name:'Deck length 15', pass: d.length===15});
      tests.push({name:'Each item has 4 answers', pass: d.every(it=>Array.isArray(it.a)&&it.a.length===4)});
      tests.push({name:'Correct index in [0,3]', pass: d.every(it=>it.c>=0 && it.c<4)});
      tests.push({name:'Guaranteed amount tiers', pass: guaranteedAmount(3)===0 && guaranteedAmount(4)===1000 && guaranteedAmount(9)===32000});
      const ids = d.map(x=>x.id); const uniq = new Set(ids);
      tests.push({name:'Unique question ids (in deck)', pass: uniq.size===ids.length});
      const arr=[1,2,3,4,5]; const arr2=shuffle([...arr]);
      tests.push({name:'Shuffle length preserved', pass: arr2.length===arr.length});
      console.group('%cSelf Tests','color:#2563eb;font-weight:bold');
      tests.forEach(t=> console[t.pass?'log':'error'](`${t.pass?'âœ…':'âŒ'} ${t.name}`));
      console.groupEnd();
    }
    runSelfTests();

    // Ä°lk yÃ¼klemede liderlik tablosunu Ã§iz
    renderLeaderboard();
  })();
  </script>
</body>
</html>
